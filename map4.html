<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Map Interaktif Kampus ke Kostan</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #map { height: 600px; }
    h2 { text-align: center; margin: 10px 0; }
    .popup-content {
      text-align: center;
      font-size: 14px;
    }
    .popup-content img {
      width: 130px;
      border-radius: 8px;
      margin-bottom: 6px;
    }
  </style>
</head>
<body>
  <h2>üó∫Ô∏è Peta Interaktif Kampus ke Kostan</h2>
  <div id="map"></div>

  <script>
    // === Inisialisasi Peta ===
    var map = L.map('map').setView([-6.9055, 106.8733], 17);

    // === Base Layer ===
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    var satellite = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      { maxZoom: 19, attribution: 'Tiles ¬© Esri' }
    );

    // === Layer Group ===
    var markerLayer = L.layerGroup();
    var polylineLayer = L.layerGroup();
    var polygonLayer = L.layerGroup();

    // === Custom Icons ===
    var campusIcon = L.icon({
      iconUrl: 'assets/icon kampus.jpg',
      iconSize: [40, 40],
      iconAnchor: [20, 40],
      popupAnchor: [0, -40]
    });

    var kostIcon = L.icon({
      iconUrl: 'assets/icon kost.png',
      iconSize: [40, 40],
      iconAnchor: [20, 40],
      popupAnchor: [0, -40]
    });

    // === Fungsi untuk Popup dan Interaksi ===
    function addInteractivity(feature, layer) {
      if (feature.properties && feature.properties.name) {
        var html = `
          <div class="popup-content">
            <h3>${feature.properties.name}</h3>
            ${feature.properties.image ? `<img src="${feature.properties.image}" alt="foto">` : ""}
            <p>${feature.properties.desc || "Tidak ada deskripsi"}</p>
            ${feature.properties.link ? `<a href="${feature.properties.link}" target="_blank">Lihat Detail</a>` : ""}
          </div>
        `;
        layer.bindPopup(html);
        layer.bindTooltip(feature.properties.name, { direction: 'top' });
      }

      // Event efek hover dan klik
      layer.on({
        mouseover: function (e) {
          if (e.target.setStyle) e.target.setStyle({ weight: 3, color: '#FFD700' });
        },
        mouseout: function (e) {
          if (e.target.setStyle) e.target.setStyle({ weight: 2, color: feature.properties.color || '#3388ff' });
        },
        click: function (e) {
          map.setView(e.latlng, 19);
        }
      });
    }

    // === Load Marker GeoJSON ===
    fetch('marker.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          pointToLayer: function (feature, latlng) {
            if (feature.properties.type === "campus") {
              return L.marker(latlng, { icon: campusIcon });
            } else if (feature.properties.type === "kost") {
              return L.marker(latlng, { icon: kostIcon });
            } else {
              return L.marker(latlng);
            }
          },
          onEachFeature: addInteractivity
        }).addTo(markerLayer);
      });

    // === Load Polyline GeoJSON ===
    fetch('polyline.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: feature => ({
            color: feature.properties.color || 'blue',
            weight: 3
          }),
          onEachFeature: addInteractivity
        }).addTo(polylineLayer);
      });

    // === Load Polygon GeoJSON ===
    fetch('polygon.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: feature => ({
            color: feature.properties.color || 'red',
            fillOpacity: 0.4,
            weight: 2
          }),
          onEachFeature: addInteractivity
        }).addTo(polygonLayer);
      });

    // === Control Layer ===
    var baseMaps = { "OpenStreetMap": osm, "Satellite": satellite };
    var overlayMaps = { "Marker": markerLayer, "Polyline": polylineLayer, "Polygon": polygonLayer };
    L.control.layers(baseMaps, overlayMaps).addTo(map);

    // === Tambahkan Layer Default ===
    markerLayer.addTo(map);
    polylineLayer.addTo(map);
    polygonLayer.addTo(map);
  </script>
</body>
</html>
